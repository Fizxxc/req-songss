<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <title>Terima Kasih | XO Music</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      background: url('https://images.unsplash.com/photo-1509223197845-458d87318791?auto=format&fit=crop&w=1950&q=80') no-repeat center center fixed;
      background-size: cover;
    }
    .glass {
      backdrop-filter: blur(20px) saturate(160%);
      -webkit-backdrop-filter: blur(20px) saturate(160%);
      background-color: rgba(17, 25, 40, 0.6);
      border-radius: 16px;
      border: 1px solid rgba(255, 255, 255, 0.2);
    }
  </style>
</head>
<body class="text-white min-h-screen flex items-center justify-center px-4">
  <div class="glass max-w-md w-full p-8 text-center">
    <h1 class="text-3xl font-bold mb-4">ğŸ§ Terima Kasih!</h1>
    <p class="mb-6 text-sm text-gray-200">Silakan masukkan nama kamu lalu klik "Kirim Request". Setelah itu request lagu kamu akan masuk antrian.</p>
    
    <input type="text" id="nama" placeholder="Nama kamu (opsional)" class="w-full p-3 mb-4 rounded-lg text-black focus:outline-none focus:ring-2 focus:ring-yellow-400" />
    
    <button id="kirimBtn" class="w-full bg-yellow-400 hover:bg-yellow-500 text-black font-semibold px-4 py-2 rounded-lg transition-all">Kirim Request</button>

    <div id="status" class="mt-4 text-sm text-center"></div>

    <p class="text-xs text-gray-400 mt-6">XO Music 2025</p>
  </div>
<script>
  let data;
  const statusBox = document.getElementById("status");
  const kirimBtn = document.getElementById("kirimBtn");

  try {
    const raw = sessionStorage.getItem("request");
    if (!raw) throw new Error("Data kosong");
    data = JSON.parse(raw);
  } catch (e) {
    statusBox.innerHTML = `<span class='text-red-400'>ğŸš« Data request tidak ditemukan. Silakan ulangi dari halaman awal.</span>`;
    kirimBtn.disabled = true;
  }

  const namaInput = document.getElementById("nama");

  kirimBtn.addEventListener("click", async () => {
    if (!data) return;

    kirimBtn.disabled = true;
    statusBox.innerHTML = "<span class='text-yellow-300'>â³ Mengirim request...</span>";

    try {
      const res = await fetch("/api/request", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          title: data.title,
          artist: data.artist,
          nama: namaInput.value.trim() || "Anonim"
        })
      });

      const result = await res.json();

      if (result.success) {
        statusBox.innerHTML = "<span class='text-green-400'>âœ… Request kamu berhasil dikirim!</span>";
      } else {
        statusBox.innerHTML = "<span class='text-red-400'>âŒ Gagal mengirim request.</span>";
      }

    } catch (e) {
      console.error(e);
      statusBox.innerHTML = "<span class='text-red-400'>ğŸš« Error saat mengirim data.</span>";
    }
  });
</script>
</body>
</html>
